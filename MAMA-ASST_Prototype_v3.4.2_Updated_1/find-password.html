<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>비밀번호 재설정 | MAMA-ASST</title>
  <meta name="description" content="MAMA-ASST 비밀번호를 재설정합니다.">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="assets/css/common.css">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23FF6D4D' rx='20' width='100' height='100'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>M</text></svg>">
  
  <style>
    /* Find Password Page Specific Styles */
    .auth-card {
      max-width: 440px;
    }
    
    .auth-icon {
      background: var(--color-coral);
    }
    
    .auth-icon svg {
      width: 28px;
      height: 28px;
    }
    
    .step-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      margin-bottom: var(--space-6);
    }
    
    .step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--color-border-light);
      transition: all var(--transition-base);
    }
    
    .step-dot.active {
      width: 24px;
      border-radius: 4px;
      background: var(--color-coral);
    }
    
    .step-dot.completed {
      background: var(--color-success);
    }
    
    /* Phone verification section */
    .send-code-btn {
      margin-top: var(--space-3);
    }
    
    .send-code-btn .btn {
      background: var(--color-coral-light);
      color: var(--color-coral);
      font-weight: var(--weight-medium);
    }
    
    .send-code-btn .btn:hover {
      background: #FFE5E0;
    }
    
    .send-code-btn .btn:disabled {
      background: var(--color-border-light);
      color: var(--color-text-tertiary);
    }
    
    /* OTP Section */
    .otp-section {
      margin-top: var(--space-6);
    }
    
    .otp-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
    }
    
    .otp-label {
      font-size: var(--text-body);
      font-weight: var(--weight-medium);
      color: var(--color-text-primary);
    }
    
    .otp-timer {
      font-size: var(--text-body);
      font-weight: var(--weight-semibold);
      color: var(--color-coral);
    }
    
    .otp-timer.expired {
      color: var(--color-error);
    }
    
    .otp-container {
      margin-bottom: var(--space-4);
    }
    
    .otp-input {
      flex: 1;
      min-width: 0;
    }
    
    .resend-link {
      text-align: center;
      font-size: var(--text-caption);
      color: var(--color-text-secondary);
    }
    
    .resend-link button {
      color: var(--color-coral);
      font-weight: var(--weight-medium);
      text-decoration: underline;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    .resend-link button:disabled {
      color: var(--color-text-tertiary);
      cursor: not-allowed;
    }
    
    /* New Password Section */
    .password-section {
      margin-top: var(--space-6);
    }
    
    .password-helper {
      font-size: var(--text-caption);
      color: var(--color-text-secondary);
      margin-top: var(--space-2);
    }
    
    /* Sections visibility */
    .section-hidden {
      display: none;
    }
    
    /* Back link */
    .back-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      margin-top: var(--space-6);
      font-size: var(--text-body);
      color: var(--color-text-secondary);
    }
    
    .back-link:hover {
      color: var(--color-coral);
    }
    
    .back-link svg {
      width: 16px;
      height: 16px;
    }
    
    /* Success state */
    .success-icon {
      width: 64px;
      height: 64px;
      background: var(--color-success-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-6);
      color: var(--color-success);
    }
    
    .success-message {
      text-align: center;
    }
    
    .success-message h2 {
      font-size: var(--text-h3);
      font-weight: var(--weight-bold);
      color: var(--color-navy);
      margin-bottom: var(--space-3);
    }
    
    .success-message p {
      font-size: var(--text-body);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-8);
    }
  </style>
</head>
<body>
  <main class="auth-layout">
    <div class="auth-card">
      <!-- Step 1 & 2: Phone Verification -->
      <div id="verificationStep">
        <header class="auth-header">
          <div class="auth-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
            </svg>
          </div>
          <h1 class="auth-title">비밀번호 재설정</h1>
          <p class="auth-subtitle">등록된 휴대폰으로 인증해주세요</p>
        </header>
        
        <div class="step-indicator">
          <span class="step-dot active" id="step1Dot"></span>
          <span class="step-dot" id="step2Dot"></span>
          <span class="step-dot" id="step3Dot"></span>
        </div>
        
        <form id="verificationForm" novalidate>
          <!-- Phone Number -->
          <div class="form-group">
            <label class="form-label" for="phone">휴대폰 번호</label>
            <input 
              type="tel" 
              id="phone" 
              class="form-input" 
              placeholder="010-0000-0000"
              autocomplete="tel"
              maxlength="13"
              required
            >
          </div>
          
          <div class="send-code-btn">
            <button type="button" id="sendCodeBtn" class="btn btn-full">인증번호 발송</button>
          </div>
          
          <!-- OTP Input -->
          <div class="otp-section section-hidden" id="otpSection">
            <div class="otp-header">
              <span class="otp-label">인증번호</span>
              <span class="otp-timer" id="otpTimer">03:00</span>
            </div>
            
            <div class="otp-container">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="0">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="1">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="2">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="3">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="4">
              <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]" data-index="5">
            </div>
            
            <p class="form-error hidden" id="otpError">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              인증번호가 일치하지 않습니다
            </p>
            
            <p class="resend-link">
              인증번호를 받지 못하셨나요? 
              <button type="button" id="resendBtn" disabled>재발송</button>
            </p>
          </div>
          
          <!-- New Password -->
          <div class="password-section section-hidden" id="passwordSection">
            <div class="form-group">
              <label class="form-label" for="newPassword">새 비밀번호</label>
              <div class="input-wrapper">
                <input 
                  type="password" 
                  id="newPassword" 
                  class="form-input" 
                  placeholder="비밀번호 입력"
                  autocomplete="new-password"
                >
                <button type="button" class="password-toggle" data-target="newPassword" aria-label="비밀번호 표시">
                  <span class="material-icons-round">visibility_off</span>
                </button>
              </div>
              <p class="password-helper">영문+숫자 조합 6자리 이상</p>
            </div>
            
            <div class="form-group">
              <label class="form-label" for="confirmPassword">비밀번호 확인</label>
              <div class="input-wrapper">
                <input 
                  type="password" 
                  id="confirmPassword" 
                  class="form-input" 
                  placeholder="비밀번호 재입력"
                  autocomplete="new-password"
                >
                <button type="button" class="password-toggle" data-target="confirmPassword" aria-label="비밀번호 표시">
                  <span class="material-icons-round">visibility_off</span>
                </button>
              </div>
              <p class="form-error hidden" id="confirmError">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                비밀번호가 일치하지 않습니다
              </p>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full mt-6" id="submitBtn">
              변경 완료
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
          </div>
        </form>
        
        <a href="login.html" class="back-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          로그인으로 돌아가기
        </a>
      </div>
      
      <!-- Success State -->
      <div id="successStep" class="section-hidden">
        <div class="success-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </div>
        <div class="success-message">
          <h2>비밀번호가 변경되었습니다!</h2>
          <p>새로운 비밀번호로 로그인해주세요.</p>
          <a href="login.html" class="btn btn-primary btn-full">로그인하기</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    // DOM Elements
    const phoneInput = document.getElementById('phone');
    const sendCodeBtn = document.getElementById('sendCodeBtn');
    const otpSection = document.getElementById('otpSection');
    const otpInputs = document.querySelectorAll('.otp-input');
    const otpTimer = document.getElementById('otpTimer');
    const otpError = document.getElementById('otpError');
    const resendBtn = document.getElementById('resendBtn');
    const passwordSection = document.getElementById('passwordSection');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const confirmError = document.getElementById('confirmError');
    const submitBtn = document.getElementById('submitBtn');
    const verificationStep = document.getElementById('verificationStep');
    const successStep = document.getElementById('successStep');
    const step1Dot = document.getElementById('step1Dot');
    const step2Dot = document.getElementById('step2Dot');
    const step3Dot = document.getElementById('step3Dot');
    
    let timerInterval;
    let timeLeft = 180; // 3 minutes
    
    // Phone number formatting
    phoneInput.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      
      if (value.length > 7) {
        value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
      } else if (value.length > 3) {
        value = value.replace(/(\d{3})(\d{0,4})/, '$1-$2');
      }
      
      e.target.value = value;
    });
    
    // Send verification code
    sendCodeBtn.addEventListener('click', async () => {
      const phoneRegex = /^010-\d{4}-\d{4}$/;
      if (!phoneRegex.test(phoneInput.value)) {
        phoneInput.classList.add('error');
        return;
      }
      
      phoneInput.classList.remove('error');
      sendCodeBtn.disabled = true;
      sendCodeBtn.textContent = '발송 중...';
      
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      sendCodeBtn.textContent = '인증번호 재발송';
      sendCodeBtn.disabled = false;
      
      // Show OTP section
      otpSection.classList.remove('section-hidden');
      otpInputs[0].focus();
      
      // Update step indicator
      step1Dot.classList.remove('active');
      step1Dot.classList.add('completed');
      step2Dot.classList.add('active');
      
      // Start timer
      startTimer();
    });
    
    // Timer function
    function startTimer() {
      timeLeft = 180;
      clearInterval(timerInterval);
      resendBtn.disabled = true;
      
      timerInterval = setInterval(() => {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        otpTimer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        
        if (timeLeft <= 30) {
          otpTimer.classList.add('expired');
        }
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          otpTimer.textContent = '시간 만료';
          resendBtn.disabled = false;
        }
      }, 1000);
    }
    
    // Resend code
    resendBtn.addEventListener('click', () => {
      otpInputs.forEach(input => input.value = '');
      otpTimer.classList.remove('expired');
      otpError.classList.add('hidden');
      startTimer();
      otpInputs[0].focus();
    });
    
    // OTP input handling
    otpInputs.forEach((input, index) => {
      input.addEventListener('input', (e) => {
        const value = e.target.value.replace(/\D/g, '');
        e.target.value = value;
        
        if (value && index < otpInputs.length - 1) {
          otpInputs[index + 1].focus();
        }
        
        // Check if all inputs are filled
        const otp = Array.from(otpInputs).map(i => i.value).join('');
        if (otp.length === 6) {
          verifyOTP(otp);
        }
      });
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !e.target.value && index > 0) {
          otpInputs[index - 1].focus();
        }
      });
      
      input.addEventListener('paste', (e) => {
        e.preventDefault();
        const pastedData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 6);
        pastedData.split('').forEach((char, i) => {
          if (otpInputs[i]) {
            otpInputs[i].value = char;
          }
        });
        if (pastedData.length === 6) {
          verifyOTP(pastedData);
        }
      });
    });
    
    // Verify OTP
    async function verifyOTP(otp) {
      // Simulate verification
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // Demo: Accept any 6-digit code
      if (otp.length === 6) {
        clearInterval(timerInterval);
        
        // Show password section
        otpSection.classList.add('section-hidden');
        passwordSection.classList.remove('section-hidden');
        phoneInput.disabled = true;
        sendCodeBtn.disabled = true;
        
        // Update step indicator
        step2Dot.classList.remove('active');
        step2Dot.classList.add('completed');
        step3Dot.classList.add('active');
        
        newPasswordInput.focus();
      } else {
        otpError.classList.remove('hidden');
        otpInputs.forEach(input => input.classList.add('error'));
      }
    }
    
    // Password visibility toggle handled by common.js initPasswordToggles

    // Form submission
    document.getElementById('verificationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      confirmError.classList.add('hidden');
      
      // Validate password
      const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/;
      if (!passwordRegex.test(newPasswordInput.value)) {
        newPasswordInput.classList.add('error');
        return;
      }
      
      // Check password match
      if (newPasswordInput.value !== confirmPasswordInput.value) {
        confirmError.classList.remove('hidden');
        confirmPasswordInput.classList.add('error');
        return;
      }
      
      // Show loading
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner"></span> 변경 중...';
      
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Show success
      verificationStep.classList.add('section-hidden');
      successStep.classList.remove('section-hidden');
    });
    
    // Clear error states on input
    [newPasswordInput, confirmPasswordInput].forEach(input => {
      input.addEventListener('input', () => {
        input.classList.remove('error');
        confirmError.classList.add('hidden');
      });
    });
  </script>
  <!-- MAMA-ASST Common Modules -->
  <script src="assets/js/common.js"></script>
  <script src="assets/js/modal.js"></script>
  <script src="assets/js/toast.js"></script>
  <script src="assets/js/table.js"></script>
  <script src="assets/js/chart-config.js"></script>

</body>
</html>
